
# Адресация памяти: Как процессор находит данные

В ассемблере регистры — это быстрые карманы, а память — огромный склад. Чтобы процессор достал данные, нужно указать, откуда именно их брать. Существуют несколько способов адресации: прямая, косвенная, со смещением и с индексом.

## 1.1 Прямая адресация

Прямая адресация — это когда процессору говорят: «Возьми данные по конкретному адресу».

```assembly
mov rax, [0x601040] ; Считать 8 байт из адреса 0x601040
```

Здесь `[0x601040]` — конкретный адрес в памяти, а регистр RAX теперь содержит данные по этому адресу.

**Аналогия:** представьте шкаф с ячейками, у каждой есть номер. Вы берёте конкретную ячейку — это прямая адресация.

## 1.2 Косвенная адресация

Косвенная адресация использует регистр как указатель. Вместо прямого адреса мы говорим: «Возьми данные по адресу, который хранится в регистре».

```assembly
mov rax, [rdi]  ; rdi хранит адрес массива
```

Если `rdi = 0x601040`, это эквивалентно `mov rax, [0x601040]`. Такой способ удобен, когда адрес динамический.

**Аналогия:** у вас в руках конверт с номером ячейки на складе. Сначала смотрите в конверт, а затем идёте за ячейкой.

## 1.3 Адресация со смещением

Адресация со смещением нужна, когда обращаемся к элементам массива:

```assembly
mov rax, [rdi + 8]   ; Берём следующий элемент (64-битный = 8 байт)
mov rax, [rdi + 16]  ; Ещё один элемент дальше
```

`[rdi + 8]` → адрес в rdi + 8 байт, `[rdi + 16]` → адрес в rdi + 16 байт.

**Аналогия:** у вас есть ряд ячеек на складе. Смещение говорит: «сдвинься на 1 шаг вперёд».

## 1.4 Адресация с индексом

Адресация с индексом позволяет гибко работать с массивами, используя регистр как индекс:

```assembly
mov rax, [rdi + rcx*8]  ; rdi = адрес массива, rcx = индекс элемента
```

Здесь `rcx*8` умножает индекс на размер элемента (8 байт для 64-битного числа). Теперь RAX содержит данные элемента с номером RCX.

**Пример:**

```assembly
; rdi = адрес массива
mov rcx, 2          ; хотим третий элемент (индекс 2)
mov rax, [rdi + rcx*8]
```

**Аналогия:** стоя у начала ряда ячеек на складе, вы считаете: «прыгну на 2 ячейки вправо — беру третий объект».

## 1.5 Сводная таблица адресации

| Тип адресации | Пример | Комментарий |
|---------------|--------|-------------|
| Прямая | `[0x601040]` | Конкретный адрес |
| Косвенная | `[rdi]` | Адрес в регистре |
| Со смещением | `[rdi+8]` | Следующий элемент массива |
| С индексом | `[rdi+rcx*8]` | Элемент массива с индексом RCX |

## 1.6 Практика: Суммирование массива

```assembly
global sum_array
sum_array:
    xor rax, rax      ; сумма = 0
    xor rcx, rcx      ; индекс = 0
    test rsi, rsi
    jz .done

.loop:
    add rax, [rdi + rcx*8] ; прибавляем элемент по индексу
    inc rcx
    dec rsi
    jnz .loop

.done:
    ret
```

- **RDI** → адрес массива
- **RSI** → количество элементов
- **RCX** → индекс текущего элемента
- **RAX** → сумма элементов

